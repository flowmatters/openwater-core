name: build-ow-core
on:
  push:
  schedule:
    - cron: '0 2 * * 0'
  workflow_dispatch:
jobs:
  build-linux:
    runs-on: ubuntu-latest
    steps:
        - uses: actions/checkout@v2
        - run: ./build/ci/all.sh
        - name: upload build
          uses: actions/upload-artifact@v2
          with:
            name: linux-${{ github.sha }}
            path: |
              ow-inspect
              ow-single
              ow-sim
              ows-ensemble
              libopenwater.h
              libopenwater.so
        - name: Release Nightly
          uses: softprops/action-gh-release@v1
          with:
            name: ubuntu-Nightly
            files: |
              ow-inspect
              ow-single
              ow-sim
              ows-ensemble
              libopenwater.h
              libopenwater.so
            fail_on_unmatched: true
  build-windows:
    runs-on: windows-latest
    steps:
        - uses: actions/checkout@v2
        - name: build
          run: ./build/ci/all.sh
          shell: bash
        - name: upload build
          uses: actions/upload-artifact@v2
          with:
            name: windows-${{ github.sha }}
            path: |
              *.exe
              1.8.21/bin/*.dll
              libopenwater.h
              libopenwater.so
        - name: Release Nightly
          uses: softprops/action-gh-release@v1
          with:
            name: windows-Nightly
            files: |
              *.exe
              1.8.21/bin/*.dll
              libopenwater.h
              libopenwater.so
            fail_on_unmatched: true
  build-osx:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v2
      - name: build
        run: ./build/ci/all.sh
      - name: upload build
        uses: actions/upload-artifact@v2
        with:
          name: macos-${{ github.sha }}
          path: |
            ow-inspect
            ow-single
            ow-sim
            ows-ensemble
            libopenwater.h
            libopenwater.so
      - name: Release Nightly
        uses: softprops/action-gh-release@v1
        with:
          name: osx-Nightly
          files: |
            ow-inspect
            ow-single
            ow-sim
            ows-ensemble
            libopenwater.h
            libopenwater.so
          fail_on_unmatched: true



